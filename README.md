# Joan

Local code review gate for AI agents. Agents push work to a local [Forgejo](https://forgejo.org) instance, a human reviews it, and only approved work gets pushed to the real upstream (GitHub, GitLab, etc.).

## How it works

```
agent commits → joan pr create → human reviews on Forgejo → joan pr push → origin
```

Joan enforces approval gates: `joan pr push` refuses to push if the PR is not approved or has unresolved comments.

## Prerequisites

- Python 3.13+
- [uv](https://docs.astral.sh/uv/)
- Docker (for the local Forgejo instance)
- A git repository

## Install from GitHub (uvx)

If you want to run Joan directly from GitHub without installing it into your project:

```bash
# Run any Joan command from the latest main branch
uvx --from git+https://github.com/sam-phinizy/joan.git joan --help

# Example setup commands
uvx --from git+https://github.com/sam-phinizy/joan.git joan init
uvx --from git+https://github.com/sam-phinizy/joan.git joan remote add
```

## Setup

**1. Start Forgejo**

```bash
cd forge/
docker compose up -d
# Forgejo is now running at http://localhost:3000
# Create an admin account in the web UI on first run
```

**2. Initialize Joan in your repo**

```bash
uv run joan init
```

This creates an API token on Forgejo and writes `.joan/config.toml`. The prompts ask for your Forgejo URL, username, password, and which repo to use.

**3. Add the review remote**

```bash
uv run joan remote add
```

Creates a private repo on Forgejo and adds `joan-review` as a git remote.

## Daily workflow

```bash
# Create a review branch and open a PR
uv run joan branch create
uv run joan pr create --title "Add feature X"

# Check review status
uv run joan pr sync

# See unresolved comments
uv run joan pr comments

# Resolve a comment after addressing it
uv run joan pr comment resolve <id>

# Push to upstream once approved
uv run joan pr push
```

## Claude Code plugin

Joan ships with a Claude Code plugin that teaches the agent the full review workflow.

```bash
# In any repo where you want Claude to use Joan
uv run joan skills install --agent claude
```

This installs the plugin to `.claude/plugins/joan/`. Claude Code will then automatically follow the Joan review cycle.

## Config

`.joan/config.toml` (auto-generated by `joan init`):

```toml
[forgejo]
url = "http://localhost:3000"
token = "..."        # API token — never commit this
owner = "yourname"
repo = "yourrepo"

[remotes]
review = "joan-review"   # default
upstream = "origin"      # default
```

Add `.joan/` to your `.gitignore` — the config contains an API token.

## Command reference

| Command | Description |
|---------|-------------|
| `joan init` | One-time setup: create token, write config |
| `joan remote add` | Create Forgejo repo, add `joan-review` remote |
| `joan branch create [name]` | Create and push a review branch |
| `joan pr create` | Open a PR on Forgejo |
| `joan pr sync` | JSON: approval status + unresolved comment count |
| `joan pr comments` | JSON: list unresolved review comments |
| `joan pr comment resolve <id>` | Mark a comment resolved |
| `joan pr push` | Push approved branch to upstream |
| `joan worktree create [name]` | Create an isolated git worktree |
| `joan worktree remove <name>` | Remove a tracked worktree |
| `joan skills install --agent claude` | Install the Claude Code plugin |
